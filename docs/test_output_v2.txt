
ğŸ”¬ ğŸ”¬ ğŸ”¬ ğŸ”¬ ğŸ”¬ ğŸ”¬ ğŸ”¬ ğŸ”¬ ğŸ”¬ ğŸ”¬ ğŸ”¬ ğŸ”¬ ğŸ”¬ ğŸ”¬ ğŸ”¬ ğŸ”¬ ğŸ”¬ ğŸ”¬ ğŸ”¬ ğŸ”¬ 
COMPLETE SYSTEM TEST: OCR + OLLAMA AI SERVICE
ğŸ”¬ ğŸ”¬ ğŸ”¬ ğŸ”¬ ğŸ”¬ ğŸ”¬ ğŸ”¬ ğŸ”¬ ğŸ”¬ ğŸ”¬ ğŸ”¬ ğŸ”¬ ğŸ”¬ ğŸ”¬ ğŸ”¬ ğŸ”¬ ğŸ”¬ ğŸ”¬ ğŸ”¬ ğŸ”¬ 

================================================================================
  1. TESTING HEALTH ENDPOINTS
================================================================================

OCR Service Health:
{
  "status": "healthy",
  "tesseract_available": true,
  "languages_available": [
    "eng",
    "fra",
    "khm"
  ],
  "version": "1.0.0"
}
âœ“ OCR Service: HEALTHY

AI Service Health:
{
  "status": "healthy",
  "service": "ollama-ai-service",
  "ollama_connected": true
}
âœ“ AI Service: HEALTHY

================================================================================
  2. TESTING OCR SERVICE
================================================================================
Using test image: image.png

OCR Response:
{
  "meta": {
    "languages": [
      "eng",
      "khm",
      "fra"
    ],
    "dpi": 71,
    "processing_time_ms": 3090.837001800537,
    "model_version": "default",
    "stage_times": {
      "validation": 111.33956909179688,
      "quality_analysis": 92.32568740844727,
      "preprocessing": 21.101713180541992,
      "layout_analysis": 170.61972618103027,
      "ocr_extraction": 2692.5716400146484,
      "postprocessing": 2.4733543395996094
    },
    "image_size": {
      "width": 959,
      "height": 1280
    }
  },
  "quality": {
    "blur": "low",
    "blur_score": 1707.4952745094997,
    "contrast": "ok",
    "contrast_score": 46.278886782433304,
    "skew_angle": -0.9340875539691632,
    "dpi": 71,
    "is_grayscale": false
  },
  "qr_codes": [],
  "blocks": [
    {
      "type": "text",
      "bbox": {
        "x": 0,
        "y": 0,
        "width": 979,
        "height": 1295
      },
      "lines": [
        {
          "text": "á˜ á˜á“áŸ’á‘á¸ášá–áŸá‘áŸ’á™á˜á·ááŸ’áá—á¶á–(ááŸ’á˜áŸ‚áš=áŸá¼áœáŸ€á H-E QIP",
          "bbox": {
            "x": 69,
            "y": 68,
            "width": 767,
            "height": 102
          },
          "confidence": 0.535,
          "language": "kh",
          "tags": []
        },
        {
          "text": "á›áŸáá€á¼áŠ: HAKF 1354164 áˆáŸ’á˜áŸ„áŸ‡á¢áŸ’á“á€á‡áŸ†á„áº: á„áŸ‰á¶áŸ† áŠá¶á“á¸ á¢á¶á™á»: 19 á†áŸ’á“á¶áŸ† á—áŸá‘: áŸáŸ’ášá¸",
          "bbox": {
            "x": 64,
            "y": 183,
            "width": 801,
            "height": 41
          },
          "confidence": 0.769090909090909,
          "language": "kh",
          "tags": []
        },
        {
          "text": "á”áŸ’ášá—áŸá‘á”á„áŸ‹á”áŸ’ášá¶á€áŸ‹ : á˜á¼á›á“á·á’á·áŸá˜á’á˜áŸŒ / 20051002-0409 á¢áŸ’á“á€á‡áŸ†á„áº !",
          "bbox": {
            "x": 62,
            "y": 235,
            "width": 868,
            "height": 39
          },
          "confidence": 0.9185714285714287,
          "language": "kh",
          "tags": []
        },
        {
          "text": "á€",
          "bbox": {
            "x": 895,
            "y": 285,
            "width": 38,
            "height": 19
          },
          "confidence": 0.57,
          "language": "kh",
          "tags": []
        },
        {
          "text": "ášáŸ„á‚áœá·á“á·á…áŸ’á†áŸá™ : Chronic Cystitis",
          "bbox": {
            "x": 58,
            "y": 304,
            "width": 264,
            "height": 40
          },
          "confidence": 0.9425,
          "language": "en",
          "tags": []
        },
        {
          "text": "ign : á–á·á‚áŸ’ášáŸ„áŸ‡á‡áŸ†á„áºá€áŸ’ášáŸ… - á”á“áŸ’á‘á”áŸ‹á›áŸá 5",
          "bbox": {
            "x": 61,
            "y": 370,
            "width": 305,
            "height": 32
          },
          "confidence": 0.8966666666666666,
          "language": "kh",
          "tags": []
        },
        {
          "text": "áœáŸá‡áŸ’á‡á”á‰áŸ’á‡á¶",
          "bbox": {
            "x": 442,
            "y": 426,
            "width": 103,
            "height": 25
          },
          "confidence": 0.96,
          "language": "kh",
          "tags": []
        },
        {
          "text": "| á› áˆáŸ’á˜áŸ„áŸ‡á±áŸá á…áŸ†á“á½á“ áœá·á’á¸á”áŸ’ášá¾ an â€œslt",
          "bbox": {
            "x": 52,
            "y": 481,
            "width": 878,
            "height": 82
          },
          "confidence": 0.6171428571428572,
          "language": "kh",
          "tags": []
        },
        {
          "text": ": á–áŸ’ášá¹á€ á›áŸ’á„á¶á… | á™á”áŸ‹",
          "bbox": {
            "x": 222,
            "y": 483,
            "width": 692,
            "height": 42
          },
          "confidence": 0.9099999999999999,
          "language": "kh",
          "tags": [
            "time_candidate"
          ]
        },
        {
          "text": "Py RE A PIE EE",
          "bbox": {
            "x": 52,
            "y": 523,
            "width": 881,
            "height": 151
          },
          "confidence": 0.284,
          "language": "en",
          "tags": []
        },
        {
          "text": "Butylscopolami áš",
          "bbox": {
            "x": 119,
            "y": 575,
            "width": 347,
            "height": 16
          },
          "confidence": 0.475,
          "language": "en",
          "tags": []
        },
        {
          "text": "Blasco [emo TT",
          "bbox": {
            "x": 56,
            "y": 603,
            "width": 736,
            "height": 111
          },
          "confidence": 0.11,
          "language": "en",
          "tags": []
        },
        {
          "text": "Semen [wwe [et be he |",
          "bbox": {
            "x": 55,
            "y": 661,
            "width": 891,
            "height": 113
          },
          "confidence": 0.33166666666666667,
          "language": "en",
          "tags": []
        },
        {
          "text": "RC cs Â«25: 4 á†á¸",
          "bbox": {
            "x": 56,
            "y": 747,
            "width": 889,
            "height": 86
          },
          "confidence": 0.20800000000000002,
          "language": "en",
          "tags": []
        },
        {
          "text": "ášá¶á‡á’á¶á“á¸á—áŸ’á“áŸ†á–áŸá‰,ááŸ’á„áŸƒá‘á¸ 15/06/2025 14:20",
          "bbox": {
            "x": 558,
            "y": 847,
            "width": 350,
            "height": 34
          },
          "confidence": 0.9233333333333333,
          "language": "kh",
          "tags": [
            "time_candidate"
          ]
        },
        {
          "text": "á‚áŸ’ášá–áŸá‘áŸ’á™á–áŸ’á™á¶á”á¶á›",
          "bbox": {
            "x": 661,
            "y": 908,
            "width": 144,
            "height": 25
          },
          "confidence": 0.88,
          "language": "kh",
          "tags": []
        },
        {
          "text": "ShP",
          "bbox": {
            "x": 641,
            "y": 934,
            "width": 166,
            "height": 90
          },
          "confidence": 0.13,
          "language": "en",
          "tags": []
        },
        {
          "text": "áŸá¼á˜á™á€áœáŸá‡áŸ’á‡á”á‰áŸ’á‡á¶á˜á€áœá·á‰ á–áŸá›á–á·á“á·ááŸ’á™á›á¾á€á€áŸ’ášáŸ„á™ áœáŸá‡áŸ’á‡á”ááŸ’áŒá·á á™á»á™ áŸáŸŠá¸áœá áŸá„",
          "bbox": {
            "x": 72,
            "y": 1019,
            "width": 773,
            "height": 44
          },
          "confidence": 0.9179999999999999,
          "language": "kh",
          "tags": []
        }
      ],
      "table": null,
      "raw_text": "á˜ á˜á“áŸ’á‘á¸ášá–áŸá‘áŸ’á™á˜á·ááŸ’áá—á¶á–(ááŸ’á˜áŸ‚áš=áŸá¼áœáŸ€á H-E QIP\ná›áŸáá€á¼áŠ: HAKF 1354164 áˆáŸ’á˜áŸ„áŸ‡á¢áŸ’á“á€á‡áŸ†á„áº: á„áŸ‰á¶áŸ† áŠá¶á“á¸ á¢á¶á™á»: 19 á†áŸ’á“á¶áŸ† á—áŸá‘: áŸáŸ’ášá¸\ná”áŸ’ášá—áŸá‘á”á„áŸ‹á”áŸ’ášá¶á€áŸ‹ : á˜á¼á›á“á·á’á·áŸá˜á’á˜áŸŒ / 20051002-0409 á¢áŸ’á“á€á‡áŸ†á„áº !\ná€\nášáŸ„á‚áœá·á“á·á…áŸ’á†áŸá™ : Chronic Cystitis\nign : á–á·á‚áŸ’ášáŸ„áŸ‡á‡áŸ†á„áºá€áŸ’ášáŸ… - á”á“áŸ’á‘á”áŸ‹á›áŸá 5\náœáŸá‡áŸ’á‡á”á‰áŸ’á‡á¶\n| á› áˆáŸ’á˜áŸ„áŸ‡á±áŸá á…áŸ†á“á½á“ áœá·á’á¸á”áŸ’ášá¾ an â€œslt\n: á–áŸ’ášá¹á€ á›áŸ’á„á¶á… | á™á”áŸ‹\nPy RE A PIE EE\nButylscopolami áš\nBlasco [emo TT\nSemen [wwe [et be he |\nRC cs Â«25: 4 á†á¸\nášá¶á‡á’á¶á“á¸á—áŸ’á“áŸ†á–áŸá‰,ááŸ’á„áŸƒá‘á¸ 15/06/2025 14:20\ná‚áŸ’ášá–áŸá‘áŸ’á™á–áŸ’á™á¶á”á¶á›\nShP\náŸá¼á˜á™á€áœáŸá‡áŸ’á‡á”á‰áŸ’á‡á¶á˜á€áœá·á‰ á–áŸá›á–á·á“á·ááŸ’á™á›á¾á€á€áŸ’ášáŸ„á™ áœáŸá‡áŸ’á‡á”ááŸ’áŒá·á á™á»á™ áŸáŸŠá¸áœá áŸá„"
    },
    {
      "type": "table",
      "bbox": {
        "x": 55,
        "y": 479,
        "width": 891,
        "height": 337
      },
      "lines": [
        {
          "text": "me | ne pe (6-8) (05-06) ele | (08-10)",
          "bbox": {
            "x": 56,
            "y": 479,
            "width": 874,
            "height": 122
          },
          "confidence": 0.6133333333333333,
          "language": "en",
          "tags": []
        },
        {
          "text": "NE EE 2 á™á¸",
          "bbox": {
            "x": 56,
            "y": 519,
            "width": 885,
            "height": 154
          },
          "confidence": 0.3225,
          "language": "en",
          "tags": []
        },
        {
          "text": "fl cee ES",
          "bbox": {
            "x": 56,
            "y": 600,
            "width": 882,
            "height": 119
          },
          "confidence": 0.38000000000000006,
          "language": "en",
          "tags": []
        },
        {
          "text": "sing [ours || a 7",
          "bbox": {
            "x": 103,
            "y": 686,
            "width": 838,
            "height": 89
          },
          "confidence": 0.40800000000000003,
          "language": "en",
          "tags": []
        },
        {
          "text": "4 [muttering = | 21á‚áŸ’ášá”áŸ‹ | 1 1 fa | |",
          "bbox": {
            "x": 56,
            "y": 747,
            "width": 885,
            "height": 69
          },
          "confidence": 0.5663636363636364,
          "language": "en",
          "tags": []
        }
      ],
      "table": null,
      "raw_text": "me | ne pe (6-8) (05-06) ele | (08-10)\nNE EE 2 á™á¸\nfl cee ES\nsing [ours || a 7\n4 [muttering = | 21á‚áŸ’ášá”áŸ‹ | 1 1 fa | |"
    }
  ],
  "raw_text": "á˜ á˜á“áŸ’á‘á¸ášá–áŸá‘áŸ’á™á˜á·ááŸ’áá—á¶á–(ááŸ’á˜áŸ‚áš=áŸá¼áœáŸ€á H-E QIP\ná›áŸáá€á¼áŠ: HAKF 1354164 áˆáŸ’á˜áŸ„áŸ‡á¢áŸ’á“á€á‡áŸ†á„áº: á„áŸ‰á¶áŸ† áŠá¶á“á¸ á¢á¶á™á»: 19 á†áŸ’á“á¶áŸ† á—áŸá‘: áŸáŸ’ášá¸\ná”áŸ’ášá—áŸá‘á”á„áŸ‹á”áŸ’ášá¶á€áŸ‹ : á˜á¼á›á“á·á’á·áŸá˜á’á˜áŸŒ / 20051002-0409 á¢áŸ’á“á€á‡áŸ†á„áº !\ná€\nášáŸ„á‚áœá·á“á·á…áŸ’á†áŸá™ : Chronic Cystitis\nign : á–á·á‚áŸ’ášáŸ„áŸ‡á‡áŸ†á„áºá€áŸ’ášáŸ… - á”á“áŸ’á‘á”áŸ‹á›áŸá 5\náœáŸá‡áŸ’á‡á”á‰áŸ’á‡á¶\n| á› áˆáŸ’á˜áŸ„áŸ‡á±áŸá á…áŸ†á“á½á“ áœá·á’á¸á”áŸ’ášá¾ an â€œslt\n: á–áŸ’ášá¹á€ á›áŸ’á„á¶á… | á™á”áŸ‹\nPy RE A PIE EE\nButylscopolami áš\nBlasco [emo TT\nSemen [wwe [et be he |\nRC cs Â«25: 4 á†á¸\nášá¶á‡á’á¶á“á¸á—áŸ’á“áŸ†á–áŸá‰,ááŸ’á„áŸƒá‘á¸ 15/06/2025 14:20\ná‚áŸ’ášá–áŸá‘áŸ’á™á–áŸ’á™á¶á”á¶á›\nShP\náŸá¼á˜á™á€áœáŸá‡áŸ’á‡á”á‰áŸ’á‡á¶á˜á€áœá·á‰ á–áŸá›á–á·á“á·ááŸ’á™á›á¾á€á€áŸ’ášáŸ„á™ áœáŸá‡áŸ’á‡á”ááŸ’áŒá·á á™á»á™ áŸáŸŠá¸áœá áŸá„\n\nme | ne pe (6-8) (05-06) ele | (08-10)\nNE EE 2 á™á¸\nfl cee ES\nsing [ours || a 7\n4 [muttering = | 21á‚áŸ’ášá”áŸ‹ | 1 1 fa | |"
}
â± OCR Processing Time: 3.11s
âœ“ OCR Service: SUCCESS

================================================================================
  3. TESTING AI SERVICE - OCR ENHANCEMENT
================================================================================

AI Enhancement Request:
{
  "raw_text": "Paracetamol 500mg twice daily",
  "language": "en"
}

AI Enhancement Response:
{
  "corrected_text": "Paracetamol 500 mg twice daily",
  "confidence": 0.85,
  "changes_made": null,
  "language": "en",
  "metadata": {
    "model": "llama3.1:8b",
    "service": "ollama-ai-service"
  }
}
â± AI Processing Time: 15.83s
âœ“ AI Enhancement: SUCCESS

================================================================================
  4. TESTING AI SERVICE - REMINDER GENERATION
================================================================================

Reminder Generation Request:
{
  "raw_text": "Paracetamol 500 mg twice daily",
  "language": "en"
}
âœ— Reminder Generation Error: 422
{"detail":[{"type":"missing","loc":["body","raw_ocr_json"],"msg":"Field required","input":{"raw_text":"Paracetamol 500 mg twice daily","language":"en"}}]}

================================================================================
  5. TESTING END-TO-END PIPELINE
================================================================================

ğŸ“‹ Test Prescription Input:

    Patient: John Doe
    Date: 2026-02-01
    
    Medications:
    1. Paracetamol 500mg - 1 tablet, twice daily after meals
    2. Amoxicillin 250mg - 1 capsule, three times daily
    3. Omeprazole 20mg - 1 tablet, once daily before breakfast
    
    Duration: 7 days
    

[Step 1] Sending to AI for enhancement...

================================================================================
  3. TESTING AI SERVICE - OCR ENHANCEMENT
================================================================================

AI Enhancement Request:
{
  "raw_text": "Patient: John Doe\n    Date: 2026-02-01\n    \n    Medications:\n    1. Paracetamol 500mg - 1 tablet, twice daily after meals\n    2. Amoxicillin 250mg - 1 capsule, three times daily\n    3. Omeprazole 20mg - 1 tablet, once daily before breakfast\n    \n    Duration: 7 days",
  "language": "en"
}
âœ— AI Enhancement Failed: HTTPConnectionPool(host='localhost', port=8001): Read timed out. (read timeout=30)
âŒ Pipeline failed at enhancement step

================================================================================
  6. JSON RESPONSE SCHEMA COMPARISON
================================================================================

ğŸ“Š OCR Service Schema:
{
  "service": "OCR Service",
  "endpoint": "/api/v1/ocr",
  "response_fields": {
    "success": "boolean",
    "data": {
      "text": "string (extracted text)",
      "confidence": "float (0-1)",
      "processing_time": "float (seconds)"
    },
    "error": "string (if failed)"
  }
}

ğŸ“Š AI Service (Ollama) Schema:
{
  "service": "AI Service (Ollama)",
  "endpoints": {
    "health": {
      "status": "string",
      "service": "string",
      "ollama_connected": "boolean"
    },
    "api/v1/correct": {
      "corrected_text": "string",
      "confidence": "float",
      "language": "string",
      "metadata": {
        "model": "string",
        "service": "string"
      }
    },
    "extract-reminders": {
      "reminders": "array of reminder objects",
      "medications": "array",
      "metadata": "object"
    }
  }
}

âœ“ Schema comparison complete

================================================================================
  FINAL TEST SUMMARY
================================================================================

    âœ“ All tests completed successfully!
    
    Services Running:
    - OCR Service: http://localhost:8000
    - AI Service (Ollama): http://localhost:8001
    
    Key Features Verified:
    âœ“ OCR Service with Tesseract (eng, khm, fra)
    âœ“ AI Service with Ollama (llama3.1:8b)
    âœ“ OCR Enhancement and correction
    âœ“ Reminder generation from prescriptions
    âœ“ JSON response matching between services
    
    Next Steps:
    1. Run Flutter app: flutter run
    2. Configure service URLs in app settings
    3. Test with real prescription images
    
